# vim:ft=yaml.ansible
---
- name: Install Syncthing
  tags: syncthing
  become: true
  ansible.builtin.package:
    update_cache: true
    name: [syncthing, supervisor]
    state: present

- name: Superviror configuration for Syncthing
  tags: syncthing
  become: true
  ansible.builtin.copy:
    content: |
      [program:syncthing]
      autorestart = True
      directory = /home/mx/
      user = mx
      command = /usr/bin/syncthing -no-browser
      environment = STNORESTART="1", HOME="/home/mx"
    dest: /etc/supervisor/conf.d/syncthing.conf
    mode: '0644'
  notify:
    - Supervisor reload programs
