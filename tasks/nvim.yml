# vim:ft=yaml.ansible
---
- name: Clone neovim
  tags: nvim
  ansible.builtin.git:
    repo: 'https://github.com/neovim/neovim.git'
    dest: "{{ git_dir }}/neovim"
    version: master
    update: true
    force: true

- name: Requirements
  tags: nvim
  become: true
  block:
    - name: Install build requirements
      ansible.builtin.package:
        pkg: "{{ nvim_build_requirements_debian }}"

#   - name: Install build requirements for Fedora
#     ansible.builtin.dnf:
#       pkg: "{{ nvim_build_requirements_fedora }}"
#     when: ansible_distribution == 'Fedora'


#   - name: Install Node and Npm
#     ansible.builtin.package:
#       pkg:
#         - nodejs
#         - npm

- name: Make
  tags: nvim
  ansible.builtin.command:
    cmd: "make -j {{ ansible_processor_vcpus }}"
    chdir: "{{ git_dir }}/neovim"
  changed_when: true

- name: Make install
  tags: nvim
  become: true
  ansible.builtin.command:
    cmd: "make install"
    chdir: "{{ git_dir }}/neovim"
  changed_when: true

#- name: Install golang
#  tags: nvim, golang
#  become: true
#  block:
#    - name: Cleanup old golang install
#      ansible.builtin.file:
#        path: /usr/local/go
#        state: absent
#
#    - name: Download new golang source
#      ansible.builtin.unarchive:
#        src: https://go.dev/dl/go{{ golang_version }}.linux-amd64.tar.gz
#        dest: /usr/local/
#        remote_src: true

- name: Setup .config/nvim
  tags: nvim_config
  ansible.builtin.git:
    repo: "git@github.com:mxbl/nvim.git"
    dest: "{{ ansible_env.HOME }}/.config/nvim"
    accept_hostkey: true
    version: main
    update: true
